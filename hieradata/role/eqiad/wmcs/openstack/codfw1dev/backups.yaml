# README:
# cinder-backup servers for eqiad1 run in the codfw DC. In order to fully recreate
# the mirror setup, the cinder-backup servers for codfw1dev run in the eqiad DC.
# That's why this hiera is in role/eqiad/ but namespaced codfw1dev.
#
# Moreover, there is a bunch of config duplication here, because otherwise the
# config this role would use comes from the eqiad DC, and we need it to be from
# the codfw DC
profile::monitoring::notifications_enabled: false

profile::contacts::role_contacts: ['WMCS SREs']
profile::ceph::auth::deploy::enabled: true

profile::ceph::auth::deploy::configuration:
  cinder-backups:
    caps:
      mon: profile rbd
      osd: profile rbd pool=codfw1dev-cinder

profile::ceph::auth::deploy::selected_creds:
  - cinder-backups


profile::ceph::client::rbd::enable_v2_messenger: true
profile::ceph::mon::hosts:
  'cloudcephmon2002-dev.codfw.wmnet':
    public:
      addr: '10.192.20.7'
  'cloudcephmon2003-dev.codfw.wmnet':
    public:
      addr: '10.192.20.9'
  'cloudcephmon2004-dev.codfw.wmnet':
    public:
      addr: '10.192.20.19'

profile::ceph::cluster_network: 192.168.4.0/22
profile::ceph::public_network: 10.192.20.0/24
profile::ceph::data_dir: /var/lib/ceph
profile::ceph::fsid: 489c4187-17bc-44dc-9aeb-1d044c9bba9e
profile::ceph::ceph_repository_component: thirdparty/ceph-nautilus-buster

profile::openstack::codfw1dev::region: codfw1dev-r
profile::openstack::codfw1dev::version: victoria
profile::openstack::codfw1dev::cinder::db_host: openstack.codfw1dev.wikimediacloud.org
profile::openstack::codfw1dev::keystone_api_fqdn: openstack.codfw1dev.wikimedia.org
profile::openstack::codfw1dev::openstack_controllers:
    - cloudcontrol1003.wikimedia.org
    - cloudcontrol1004.wikimedia.org
    - cloudcontrol1005.wikimedia.org
profile::openstack::codfw1dev::cinder::api_bind_port: 18776
profile::openstack::codfw1dev::cinder::ceph_pool: codfw1dev-cinder
profile::ceph::client::rbd::libvirt_rbd_cinder_uuid: f83e2286-bff1-47bf-bf6d-109c427d63c9

profile::openstack::codfw1dev::cinder::backup::active: true
profile::openstack::codfw1dev::cinder::backup::path: /srv/cinder-backups/
profile::openstack::codfw1dev::cinder::backup::lvm::pv_units:
  - /dev/vdb
profile::openstack::codfw1dev::cinder::backup::lvm::vg_name: backup
profile::openstack::codfw1dev::cinder::backup::lvm::lv_name: cinder-backups
profile::openstack::codfw1dev::cinder::backup::lvm::lv_size: 20GB
profile::openstack::codfw1dev::cinder::backup::lvm::lv_format: ext4
