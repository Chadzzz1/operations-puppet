cluster: kubernetes-staging
profile::base::overlayfs: true
profile::docker::engine::declare_service: true
profile::kubernetes::pki::intermediate: 'wikikube_staging'
profile::kubernetes::use_cni: true
profile::docker::engine::settings:
  bridge: none
  iptables: false
  ip-masq: false
  log-opts:
    max-size: 100m
  live-restore: true
profile::monitoring::nrpe_check_disk_options: -w 10% -c 5% -W 6% -K 3% -l -e -A -i '/(var/lib|run)/(docker|kubelet)/*' --exclude-type=tracefs
# Tokens for the calico kubernetes users in private repo at:
#profile::calico::kubernetes::calico_cni::token
#profile::calico::kubernetes::calicoctl::token
profile::kubernetes::node::kubelet_cluster_domain: 'cluster.local'
# Defined in the private repo
#profile::kubernetes::node::kubelet_token:
# Defined in the private repo
#profile::kubernetes::node::kubeproxy_token:
profile::rsyslog::kubernetes::enable: true
# Define in the private repo
# profile::rsyslog::kubernetes::token
# With k8s 1.16, this will enable the IPv6DualStack feature gate for kubelet only, see I54a042731f60dc02494907022cb8115fae052c50
profile::kubernetes::ipv6dualstack: true
profile::contacts::role_contacts: ['ServiceOps']

profile::dragonfly::dfdaemon::ensure: present
profile::rsyslog::kubernetes::kubernetes_url: https://kubestagemaster.svc.%{::site}.wmnet:6443
profile::kubernetes::master_fqdn: kubestagemaster.svc.%{::site}.wmnet
profile::kubernetes::node::prometheus_url: http://prometheus.svc.%{::site}.wmnet/k8s-staging
# We don't need conftool safe restart scripts on k8s.
profile::lvs::realserver::use_conftool: false
profile::lvs::realserver::pools:
  k8s-ingress-staging: {}
