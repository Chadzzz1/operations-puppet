admin::groups:
  - gerrit-root
  - gerrit-admin

gerrit::server::host: 'gerrit.wikimedia.org'
gerrit::server::config: 'gerrit.config.erb'

# When promoting a master set this to false
# in the corresponding hosts yaml file.
gerrit::server::is_replica: true
gerrit::server::replica_hosts:
    - 'gerrit-replica.wikimedia.org'

# This affects which server is rsync source for data migration
# but is not the actual switch for Gerrit. See "is_replica" above.
gerrit::server::master_host: 'cobalt.wikimedia.org'
gerrit::server::data_dir: '/srv/gerrit'
gerrit::server::user_name: 'gerrit2'

# External backups
gerrit::server::bacula: 'srv-gerrit-git'

# SSL/TLS certs
gerrit::server::use_acmechief: true

# List of gerrit servers used in firewall rules.
gerrit::servers:
 - cobalt.wikimedia.org
 - gerrit1001.wikimedia.org
 - gerrit2001.wikimedia.org

# Assume all production nodes are slaves
gerrit::jetty::git_dir: '/srv/gerrit/git'
gerrit::jetty::ssh_host_key: 'ssh_host_key'
gerrit::jetty::replication:
    github:
        url: 'git@github.com:wikimedia/${name}'
        authGroup: 'mediawiki-replication'
        remoteNameStyle: 'dash'
        mirror: false
        push:
            - '+refs/heads/*:refs/heads/*'
            - '+refs/tags/*:refs/tags/*'
        createMissingRepositories: false
        maxRetries: 50
        replicatePermissions: false
        # Double escape backslashes:
        # once for regex, once for gitconfig formatting
        projects:
            - '^(?:(?!apps\\/ios\\/).)*$'
            - '^(?:(?!apps\\/android\\/).)*$'
    replica_codfw:
        url: 'gerrit2@gerrit2001.wikimedia.org:/srv/gerrit/git/${name}.git'
        mirror: true
        replicateProjectDeletions: true
        replicateHiddenProjects: true
        defaultForceUpdate: true
        replicationDelay: 5

# Allow use of supplemental key for scap deployment
profile::base::ssh_server_settings:
    authorized_keys_file: '/etc/ssh/userkeys/%u /etc/ssh/userkeys/%u.d/cumin /etc/ssh/userkeys/%u.d/gerrit-scap'

