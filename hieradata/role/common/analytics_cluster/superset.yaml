nagios_group: analytics_eqiad
cluster: analytics
admin::groups:
  - analytics-admins

# Database password will be filled added in profile::superset from the
# profile::superset::database_password hiera variable stored in the private repo.
profile::superset::database_uri: mysql://superset@an-coord1001.eqiad.wmnet/superset_production?ssl_ca=/etc/ssl/certs/Puppet_Internal_CA.pem
profile::superset::workers: 8
profile::superset::ldap_proxy_enabled: true
profile::superset::enable_cas: false

# TLS Terminator settings
# Please note: the service name is used to pick up the
# TLS certificate tha nginx will use. Since the Analytics
# team has only one certificate for its UIs, then the service
# name listed does not reflect how the nginx proxy is set up.
# superset.wikimedia.org is a SAN of the yarn.wikimedia.org
# TLS certificate.
profile::tlsproxy::instance::ssl_compatibility_mode: strong
profile::tlsproxy::service::cert_domain_name: yarn.wikimedia.org
profile::tlsproxy::service::upstream_ports:
  - 80
profile::tlsproxy::service::check_uri: "/health_check"
profile::tlsproxy::service::check_service: "superset.wikimedia.org"
profile::tlsproxy::service::notes_url: "https://wikitech.wikimedia.org/wiki/Analytics/Systems/Cluster"
profile::tlsproxy::service::contact_group: 'analytics'

profile::superset::presto_cluster: analytics-presto

profile::kerberos::keytabs::keytabs_metadata:
  - role: 'superset'
    owner: 'superset'
    group: 'superset'
    filename: 'superset.keytab'

profile::idp::client::httpd::vhost_content: 'profile/idp/client/httpd-superset.erb'
profile::idp::client::httpd::document_root: '/var/www'
profile::idp::client::httpd::virtual_host: 'superset.wikimedia.org'
profile::idp::client::httpd::proxied_as_https: true
profile::idp::client::httpd::required_groups:
  - 'cn=ops,ou=groups,dc=wikimedia,dc=org'
  - 'cn=wmf,ou=groups,dc=wikimedia,dc=org'
  - 'cn=nda,ou=groups,dc=wikimedia,dc=org'
