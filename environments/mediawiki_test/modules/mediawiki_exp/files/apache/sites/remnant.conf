# Meta
Include "sites-available/meta.wikimedia.org.conf"
# Wikisource
Include "sites-available/_wikisource.org.conf"
# Wikimedia Commons
Include "sites-available/commons.wikimedia.org.conf"

# Simple private wikis, https only
# This includes:
# Internal grants wiki
# fdc.wikimedia.org - Funds Dissemination Committee Wiki
# Internal wiki
# Board wiki
# Board Governance Committee
# Spcom wiki
# Affcom wiki
# search committee private wiki
# office private wiki
# chair private wiki
# auditcom private wiki
# OTRS private wiki
# Executive director's private wiki
# Private wiki for collaboration
# movementroles wiki
# checkuser private wiki
# steward private wiki
# ombudsmen private wiki
# Project Grants Committee (private)
# CoC Committee (private)
# Election Committee (private)
# Advisors Wiki (private)
<VirtualHost *:80>
    ServerName internal.wikimedia.org
    ServerAlias grants.wikimedia.org fdc.wikimedia.org board.wikimedia.org boardgovcom.wikimedia.org
    ServerAlias spcom.wikimedia.org affcom.wikimedia.org searchcom.wikimedia.org
    ServerAlias office.wikimedia.org chair.wikimedia.org auditcom.wikimedia.org otrs-wiki.wikimedia.org
    ServerAlias exec.wikimedia.org collab.wikimedia.org movementroles.wikimedia.org checkuser.wikimedia.org
    ServerAlias steward.wikimedia.org ombudsmen.wikimedia.org projectcom.wikimedia.org techconduct.wikimedia.org
    ServerAlias electcom.wikimedia.org advisors.wikimedia.org

    AllowEncodedSlashes On
    
    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://%{HTTP_HOST}/$1 [R=301,L,NE]

    Include "sites-enabled/wikimedia-common.incl"
</VirtualHost>


# Incubator wiki
<VirtualHost *:80>
    ServerName incubator.wikimedia.org

    RewriteEngine On
    RewriteRule . - [E=RW_PROTO:%{HTTP:X-Forwarded-Proto}]
    RewriteCond %{ENV:RW_PROTO} !=https
    RewriteRule . - [E=RW_PROTO:http]

    Include "sites-enabled/wikimedia-common.incl"
    Include "sites-enabled/wikimedia-legacy.incl"
</VirtualHost>

# WikiSpecies wiki
<VirtualHost *:80>
    ServerName species.wikimedia.org

    RewriteEngine On
    RewriteRule . - [E=RW_PROTO:%{HTTP:X-Forwarded-Proto}]
    RewriteCond %{ENV:RW_PROTO} !=https
    RewriteRule . - [E=RW_PROTO:http]

    Include "sites-enabled/wikimedia-common.incl"
    Include "sites-enabled/wikimedia-legacy.incl"
    # Uploads are offsite
    RewriteRule ^/upload/(.*)$ %{ENV:RW_PROTO}://upload.wikimedia.org/wikipedia/species/$1 [R=302]
</VirtualHost>

# Usability Wiki
<VirtualHost *:80>
    DocumentRoot "/srv/mediawiki/docroot/wikimedia.org"
    ServerName usability.wikimedia.org

    AllowEncodedSlashes On

    RewriteEngine On
    RewriteRule . - [E=RW_PROTO:%{HTTP:X-Forwarded-Proto}]
    RewriteCond %{ENV:RW_PROTO} !=https
    RewriteRule . - [E=RW_PROTO:http]

    # Primary wiki redirector:
    Alias /wiki /srv/mediawiki/docroot/wikimedia.org/w/index.php

    Include "sites-enabled/public-wiki-rewrites.incl"
    Include "sites-enabled/wikimedia-legacy.incl"

    RewriteRule ^/math/(.*) %{ENV:RW_PROTO}://upload.wikimedia.org/math/$1 [R=301]

    <Directory "/srv/mediawiki/docroot/wikimedia.org/w">
        <IfModule mod_php5.c>
            php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/srv/mediawiki/docroot/wikimedia.org/w/extensions">
        <IfModule mod_php5.c>
            php_admin_flag engine off
        </IfModule>
    </Directory>
</VirtualHost>

# strategy  wiki
<VirtualHost *:80>
    ServerName strategy.wikimedia.org

    RewriteEngine On
    RewriteRule . - [E=RW_PROTO:%{HTTP:X-Forwarded-Proto}]
    RewriteCond %{ENV:RW_PROTO} !=https
    RewriteRule . - [E=RW_PROTO:http]

    Include "sites-enabled/wikimedia-common.incl"
    Include "sites-enabled/wikimedia-legacy.incl"
</VirtualHost>

# advisory board PUBLIC wiki
<VirtualHost *:80>
    ServerName advisory.wikimedia.org

    RewriteEngine On
    Include "sites-enabled/wikimedia-common.incl"
    Include "sites-enabled/wikimedia-legacy.incl"
</VirtualHost>

# quality private wiki
<VirtualHost *:80>
    ServerName quality.wikimedia.org

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://quality.wikimedia.org/$1 [R=301,L,NE]
    Include "sites-enabled/wikimedia-common.incl"
    Include "sites-enabled/wikimedia-legacy.incl"
</VirtualHost>

# Outreach Wiki
<VirtualHost *:80>
    ServerName outreach.wikimedia.org
    Include "sites-enabled/wikimedia-common.incl"
    Include "sites-enabled/wikimedia-legacy.incl"
</VirtualHost>

<VirtualHost *:80>
    ServerName advisors.wikimedia.org

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://advisors.wikimedia.org/$1 [R=301,L,NE]
    Include "sites-enabled/wikimedia-common.incl"
</VirtualHost>

## donatewiki has been moved to main.conf so it can catch donate.wikipedia.org
