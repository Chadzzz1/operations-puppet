#!/bin/bash
url=$1
wikitechdir=$2

# Don't get anything with query params, filter out any whines about missing timestamp for index.html
# as well url download announcements and summary, we only care about anything else
wget --reject-regex '(.*)\?(.*)' -nv -e robots=off -k -nH --wait 30 -np -m $url -P $wikitechdir  2>&1  \
    | grep -E -v '(turned off|URL:http|FINISHED|Total|Downloaded)'

# Delete wikitech's autogenerated index.html files when done
find $wikitechdir -name 'index.html*' -delete

# Remove dumps older than 90 days
find $wikitechdir -type f -mtime +90 -delete