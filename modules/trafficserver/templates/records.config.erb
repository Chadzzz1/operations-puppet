# https://docs.trafficserver.apache.org/en/latest/admin-guide/files/records.config.en.html
# This file is managed by Puppet.

# traffic_manager TCP ports
CONFIG proxy.config.http.server_ports STRING <%= @port %> <%= @port %>:ipv6

CONFIG proxy.config.admin.user_id STRING <%= @user %>
CONFIG proxy.config.http.cache.required_headers INT 0
# Do not cache responses to cookies
CONFIG proxy.config.http.cache.cache_responses_to_cookies INT 0
CONFIG proxy.config.http.insert_squid_x_forwarded_for INT 0
CONFIG proxy.config.url_remap.pristine_host_hdr INT 1
CONFIG proxy.config.disable_configuration_modification INT 1

<% if @enable_xdebug -%>
# XDebug Plugin
CONFIG proxy.config.diags.debug.enabled INT 1
CONFIG proxy.config.diags.debug.tags STRING xdebug.headers
<% end -%>

# logging: send diags to stdout/stderr (systemd journal)
CONFIG proxy.config.diags.output.status STRING O
CONFIG proxy.config.diags.output.note STRING O
CONFIG proxy.config.diags.output.warning STRING O
CONFIG proxy.config.diags.output.error STRING E
CONFIG proxy.config.diags.output.fatal STRING E
CONFIG proxy.config.diags.output.alert STRING E
CONFIG proxy.config.diags.output.emergency STRING E

# Outbound TLS settings
CONFIG proxy.config.ssl.client.TLSv1 INT <%= @outbound_tlsv1 %>
CONFIG proxy.config.ssl.client.TLSv1_1 INT <%= @outbound_tlsv1_1 %>
CONFIG proxy.config.ssl.client.TLSv1_2 INT <%= @outbound_tlsv1_2 %>
<% if @outbound_tls_cipher_suite != '' -%>
CONFIG proxy.config.ssl.client.cipher_suite STRING <%= @outbound_tls_cipher_suite %>
<% end -%>
