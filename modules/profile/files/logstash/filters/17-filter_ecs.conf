# Early-stage ECS filter for entries that enter the pipeline ECS-compliant
filter {
  if [ecs][version] == "1.7.0" or [ecs.version] == "1.7.0" {
    # Expand dot-delimited keys to nested objects
    ruby {
      path => "/etc/logstash/filter_scripts/dot_expander.rb"
      id => "filter/ruby/dot_expander"
    }

    # Parse timestamp field if available
    if [timestamp] {
      date {
        match => [ "timestamp", "ISO8601" ]
        target => "@timestamp"
        id => "filter/date/timestamp"
      }
    }
  }
}
