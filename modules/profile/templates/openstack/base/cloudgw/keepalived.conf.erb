# this file is managed by puppet:
# modules/profile/templates/openstack/base/cloudgw/keepalived.conf.erb

global_defs {
}

vrrp_instance VRRP1 {
  state BACKUP
  # we are not interested in tracking the state of control plane interface <%= @nic_sshplanae %>
  dont_track_primary
  interface <%= @nic_sshplane %>
  virtual_router_id 52
  priority <%= scope.call_function('fqdn_rand', [100]) %>
  advert_int 1
  authentication {
    auth_type PASS
    auth_pass <%= @vrrp_passwd %>
  }
  # go to FAULT state if the NICs go down
  track_interface {
    <%= @nic_dataplane %>.<%= @virt_vlan %>
    <%= @nic_dataplane %>.<%= @wan_vlan %>
  }
  virtual_ipaddress {
<% @vrrp_vips.each do |vip| -%>
    <%= vip %>
<% end -%>
  }
  unicast_peer {
    <%= scope.function_ipresolve([@vrrp_peer, 4]) %>
  }
}
