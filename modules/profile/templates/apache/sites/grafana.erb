# Apache configuration for Grafana.
# This file is managed by Puppet.
<VirtualHost *:80>
  ServerName <%= @domain %>
  DocumentRoot /usr/share/grafana/public

<% if @enable_cas %>
  Redirect "/login" "https://grafana-rw.wikimedia.org"
  ProxyPass /login !
<% end %>

  ProxyPreserveHost On
  ProxyPass / http://localhost:3000/
  ProxyPassReverse / http://localhost:3000/

  RequestHeader unset X-WEBAUTH-USER

  # Automatically log in all visitors as anonymous.
  RequestHeader set X-WEBAUTH-USER "Anonymous"
</VirtualHost>
