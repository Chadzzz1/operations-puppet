#####################################################################
### THIS FILE IS MANAGED BY PUPPET
#####################################################################
# vim: filetype=apache

<VirtualHost *:443>
  ServerName <%= @vhost %>

  DocumentRoot /var/www/html

  SSLEngine on
  <%= @ssl_settings.join("\n    ") %>
  SSLCertificateFile <%= @facts['puppet_config']['hostcert'] %>
  SSLCertificateKeyFile <%= @facts['puppet_config']['hostprivkey'] %>
  SSLCACertificateFile <%= @facts['puppet_config']['localcacert'] %>
  SSLCARevocationFile <%= @facts['puppet_config']['ssldir'] %>/crl.pem
  SSLVerifyClient require
  SSLVerifyDepth 1

  <Location />
    ProxyPass <%= @cfssl_backend %>
  </Location>
  LogLevel warn
  ErrorLog /var/log/apache2/<%= @vhost %>_error.log
  CustomLog /var/log/apache2/<%= @vhost %>_access.log wmf
</VirtualHost>
