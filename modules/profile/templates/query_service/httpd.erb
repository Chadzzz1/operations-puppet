<VirtualHost *:80>
    ServerName <%= @domain_name %>
    ServerAdmin noc@wikimedia.org
    DocumentRoot /srv/org/wikidata/query

    ServerSignature On

    LogLevel warn
    ErrorLog /var/log/apache2/<%= @domain_name %>.error.log
    CustomLog /var/log/apache2/<%= @domain_name %>.access.log wmf

    # Rewrite not-found top-level assets into the per-site docroot to
    # support per-site favicon/etc.
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^/([^/]+)$ /srv/org/wikidata/query/sites/<%= @deploy_name %>/$1

    <Directory />
        Options FollowSymLinks
        AllowOverride None
    </Directory>

    <Directory /srv/org/wikidata/query>
        Header set Cache-Control "max-age=3600, must-revalidate"
        Options Indexes FollowSymLinks MultiViews
        AllowOverride None
        Require all granted
    </Directory>

    Alias /querybuilder    "/srv/org/wikidata/query-builder"
    <Directory /srv/org/wikidata/query-builder>
        Header set Cache-Control "max-age=3600, must-revalidate"
        Options Indexes FollowSymLinks MultiViews
        AllowOverride None
        Require all granted
    </Directory>

</VirtualHost>
