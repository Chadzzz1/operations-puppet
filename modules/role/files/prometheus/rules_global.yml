# Generated by promtool v2.5.0 `promtool update rules rules_global.conf`
groups:
- name: rules_global.conf
  rules:
  - record: site_job:varnish_requests:avail5m
    expr: sum by(site, job) (job_method_status:varnish_requests:rate5m{status=~"5.."})
      / sum by(site, job) (job_method_status:varnish_requests:rate5m{status=~"[12345].."})
  - record: site_cluster:nginx_requests:avail5m
    expr: sum by(site, cluster) (cluster_status:nginx_http_requests_total:rate5m{status=~"5.."})
      / sum by(site, cluster) (cluster_status:nginx_http_requests_total:rate5m{status=~"[12345].."})
  - record: site_job_backend:varnish_backend_requests:avail5m
    expr: sum by(backend, site, job) (job_method_status_backend:varnish_backend_requests_seconds_count:rate5m{status=~"5.."})
      / sum by(backend, site, job) (job_method_status_backend:varnish_backend_requests_seconds_count:rate5m{status=~"[12345].."})
  - record: site_job_backend:trafficserver_backend_requests:avail5m
    expr: sum by(backend, site, job) (job_method_status_backend:trafficserver_backend_requests_seconds_count:rate5m{status=~"5.."})
      / sum by(backend, site, job) (job_method_status_backend:trafficserver_backend_requests_seconds_count:rate5m{status=~"[12345].."})
  - record: site_job:varnish_requests:avg1d
    expr: sum by(site, job) (avg_over_time(job_method_status:varnish_requests:rate5m[1d]))
  - record: site_job:varnish_requests:avg7d
    expr: sum by(site, job) (avg_over_time(job_method_status:varnish_requests:rate5m[1w]))
