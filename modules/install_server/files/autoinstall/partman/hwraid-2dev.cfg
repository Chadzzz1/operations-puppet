# SPDX-License-Identifier: Apache-2.0

# Configuration to create:
# Hardware RAID1 on 2 SFF drives in flex bays mounted at /dev/sda
# 1G on /boot outside of LVM
# LVM volume of 95% remainder of sda is /
# Hardware RAID10 mounted at /dev/sdb
# 95% of sdb allocated with LVM as /srv

# remove any LVM already on the disks
d-i	partman-lvm/device_remove_lvm	boolean	true

# We'll be creating LVMs and partitioning disks SDA and SDB
d-i	partman-auto/method	string	lvm
d-i	partman-auto/disk	string	/dev/sda /dev/sdb

# setup a /boot partition of 1GB outside of the LVM
d-i	partman-auto/expert_recipe	string	lvm ::	\
		1000 2000 1000 ext4	\
				$primary{ }		\
				$bootable{ }	\
				method{ format }	\
				format{ }		\
				use_filesystem{ }	\
				filesystem{ ext4 }	\
				mountpoint{ /boot }	\
				device { /dev/sda }	\
		100000 100000 -1 ext4			\
				$primary{ }		\
				method{ lvm }		\
				device{ /dev/sda2 }	\
				vg_name{ vg1 }		\
		. \
		100000 100000 -1 ext4			\
				$primary{ }		\
				method{ lvm }		\
				device{ /dev/sdb }	\
				vg_name{ vg2 }		\
		. \
		8192 8192 8192 linux-swap		\
				$lvmok{ } in_vg{ vg1 }	\
				lv_name{ swap }		\
				method{ swap } format{ }\
		. \
		100000 100000 100000 ext4		\
				$lvmok{ } in_vg{ vg1 }	\
				lv_name{ root }		\	
				method{ format }	\
				format{ }		\
				use_filesystem{ }	\
				filesystem{ ext4 }	\
				label{ root }		\
				mountpoint{ / }		\
		. \
		100000 1000000 -1 ext4			\
				$lvmok{ } in_vg{ vg2 }	\
				lv_name{ srv }		\
				method{ format }	\
				format{ }		\
				use_filesystem{ }	\
				filesystem{ ext4 }	\
				label{ var }		\
				mountpoint{ /srv }	\ 


d-i	partman-auto-lvm/guided_size	string	95%
d-i	partman/confirm_write_new_label	boolean	true
d-i	partman/choose_partition	select	finish
d-i	partman/confirm			boolean	true
d-i	partman/confirm_nooverwrite 	boolean	true
d-i     partman-lvm/confirm	     boolean true
d-i     partman-lvm/confirm_nooverwrite boolean true
d-i     partman-lvm/device_remove_lvm   boolean true
