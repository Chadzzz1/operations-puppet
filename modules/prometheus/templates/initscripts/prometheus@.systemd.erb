[Unit]
Description=prometheus server (instance %i)

[Service]
User=prometheus
<% if @prometheus_v2 -%>
ExecStart=/usr/bin/prometheus --storage.tsdb.path <%= @metrics_path %> --web.listen-address <%= @listen_address %> --web.external-url <%= @external_url %> --storage.tsdb.retention <%= @storage_retention %> --config.file <%= @base_path %>/prometheus.yml --storage.tsdb.max-block-duration=24h --query.max-samples=10000000
<% else -%>
ExecStart=/usr/bin/prometheus -storage.local.max-chunks-to-persist <%= @max_chunks_to_persist %> -storage.local.memory-chunks <%= @memory_chunks %> -storage.local.path <%= @metrics_path %> -web.listen-address <%= @listen_address %> -web.external-url <%= @external_url %> -storage.local.retention <%= @storage_retention %> -config.file <%= @base_path %>/prometheus.yml -storage.local.chunk-encoding-version <%= @storage_encoding %> <% if @alertmanager_url != nil %>-alertmanager.url <%= @alertmanager_url %><% end %>
<% end -%>
Restart=on-failure
RestartSec=2s
TimeoutStopSec=10m
LimitNOFILE=32768
SyslogIdentifier=prometheus@%i
ExecReload=/bin/kill -HUP $MAINPID
