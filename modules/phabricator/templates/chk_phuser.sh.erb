#!/bin/bash
# Get the email address for a Phabricator user
# and check if it's verified.
phab_user=$1
db_user=<%= scope.lookupvar('passwords::mysql::phabricator::metrics_user') %>
db_pass=<%= scope.lookupvar('passwords::mysql::phabricator::metrics_pass') %>
db_host=<%= @mysql_slave %>
db_port=<%= @mysql_slave_port %>

if [ -z $phab_user ];
    then echo "please provide a Phabricator username as the first argument"
    exit 1
fi

mysql -u ${db_user} -h ${db_host} -P ${db_port} phabricator_user -p${db_pass} -e "select user.userName,user.id,user.phid,user_email.address,user_email.isverified from user join user_email on user_email.userPHID=user.phid where user.userName='${phab_user}';"

