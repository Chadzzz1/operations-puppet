[DEFAULT]
debug = true
osapi_share_base_URL = <%= @keystone_api_fqdn %>
auth_strategy = keystone
state_path = /var/lib/manila
my_ip = <%= @ipaddress %>
osapi_share_listen = <%= @ipaddress %>
osapi_share_listen_port = <%= @api_bind_port %>
osapi_share_workers = 1
osapi_share_use_ssl = false
transport_url = rabbit://<%= @openstack_controllers.map{ |rabbit_host| "#{@rabbit_user}:#{@rabbit_pass}\@#{rabbit_host}:5672" }.join(',') %>
network_plugin_ipv4_enabled = true
network_plugin_ipv6_enabled = false

# Default share type to use. (string value)
#default_share_type = <None>
# Default share group type to use. (string value)
#default_share_group_type = <None>

# A list of share backend names to use. These backend names should be
# backed by a unique [CONFIG] group with its options. (list value)
enabled_share_backends = wmcs-nfs

[wmcs-nfs]
share_backend_name = wmcs-nfs
share_driver = manila.share.drivers.generic.GenericShareDriver
driver_handles_share_servers = True
interface_driver = manila.network.linux.interface.NoopInterfaceDriver
connect_share_server_to_tenant_network = True
admin_network_id = <%= @network_id %>
admin_subnet_id = <%= @subnet_id %>
enabled_share_protocols = NFS
share_name_template = share-%s
share_snapshot_name_template = share-snapshot-%s

# Number of shares allowed per project. (integer value)
quota_shares = 50
# Number of share snapshots allowed per project. (integer value)
quota_snapshots = 50
# Number of share gigabytes allowed per project. (integer value)
quota_gigabytes = 1000
# Number of snapshot gigabytes allowed per project. (integer value)
quota_snapshot_gigabytes = 1000
# Number of share-networks allowed per project. (integer value)
quota_share_networks = 0
# Number of share-replicas allowed per project. (integer value)
quota_share_replicas = 0
# Number of replica gigabytes allowed per project. (integer value)
quota_replica_gigabytes = 0
# Number of share group snapshots allowed. (integer value)
#quota_share_group_snapshots = 50
# Maximum number of volume gigabytes to allow per host. (integer
# value)
max_gigabytes = 10000

# The template for mounting shares for this backend. Must specify the
# executable with all necessary parameters for the protocol supported.
# 'proto' template element may not be required if included in the
# command. 'export' and 'path' template elements are required. It is
# advisable to separate different commands per backend. (string value)
share_mount_template = mount -vt %(proto)s %(options)s %(export)s %(path)s

# The template for unmounting shares for this backend. Must specify
# the executable with all necessary parameters for the protocol
# supported. 'path' template element is required. It is advisable to
# separate different commands per backend. (string value)
share_unmount_template = umount -v %(path)s

# Volume name template. (string value)
volume_name_template = manila-share-%s

# Volume snapshot name template. (string value)
volume_snapshot_name_template = manila-snapshot-%s

# Parent path in service instance where shares will be mounted.
# (string value)
share_mount_path = /shares

# Maximum time to wait for creating cinder volume. (integer value)
#max_time_to_create_volume = 180

# Maximum time to wait for extending cinder volume. (integer value)
#max_time_to_extend_volume = 180

# Maximum time to wait for attaching cinder volume. (integer value)
#max_time_to_attach = 120

# Specify list of share export helpers. (list value)
share_helpers = NFS=manila.share.drivers.helpers.NFSHelper

# Filesystem type of the share volume. (string value)
# Possible values:
# ext4 - <No description provided>
# ext3 - <No description provided>
share_volume_fstype = ext4

volume_api_class = manila.volume.cinder.API
cinder_volume_type = <%= @cinder_volume_type %>

# User in service instance that will be used for authentication.
# (string value)
service_instance_user = <%= @service_instance_user %>

# Password for service instance user. (string value)
service_instance_password = <%= @service_instance_pass %>

# Path to host's private key. (string value)
#path_to_private_key = <None>

# Maximum time in seconds to wait for creating service instance.
# (integer value)
#max_time_to_build_instance = 300

# Name of image in Glance, that will be used for service instance
# creation. Only used if driver_handles_share_servers=True. (string
# value)
service_image_name = <%= @service_image %>

# Name of service instance. Only used if
# driver_handles_share_servers=True. (string value)
service_instance_name_template = manila-service-instance-%s

# Keypair name that will be created and used for service instances.
# Only used if driver_handles_share_servers=True. (string value)
#manila_service_keypair_name = manila-service

# Path to hosts public key. Only used if
# driver_handles_share_servers=True. (string value)
#path_to_public_key = ~/.ssh/id_rsa.pub

# Security group name, that will be used for service instance
# creation. Only used if driver_handles_share_servers=True. (string
# value)
#service_instance_security_group = manila-service

# ID of flavor, that will be used for service instance creation. Only
# used if driver_handles_share_servers=True. (string value)
service_instance_flavor_id = <%= @nova_flavor_id %>

# Whether share servers will be deleted on deletion of the last share.
# (boolean value)
#delete_share_server_with_last_share = false

# If set to True, then manila will deny access and remove all access
# rules on share unmanage.If set to False - nothing will be changed.
# (boolean value)
#unmanage_remove_access_rules = false

# If set to True, then Manila will delete all share servers which were
# unused more than specified time .If set to False - automatic
# deletion of share servers will be disabled. (boolean value)
automatic_share_server_cleanup = false

[cinder]
region_name = <%= @region %>
auth_url = http://<%= @keystone_api_fqdn %>:8776/v3/
auth_type = v3password
password = <%= @user_pass %>
project_domain_name = default
auth_type = v3password
default_domain_name = default
project_domain_name = default
project_name = service
user_domain_id = default
user_domain_name = default
username = manila-srv

[database]
connection = mysql+pymysql://<%= @db_user %>:<%= @db_pass %>@<%= @db_host %>/<%= @db_name %>

[glance]
api_microversion = 2
region_name = <%= @region %>
auth_url = http://<%= @keystone_api_fqdn %>:5000/v3
auth_type = v3password
default_domain_name = default
password = <%= @user_pass %>
project_domain_name = default
project_name = service
user_domain_id = default
user_domain_name = default
username = manila-srv

[keystone_authtoken]
auth_type = password
www_authenticate_uri = http://<%= @keystone_api_fqdn %>:5000
auth_url = http://<%= @keystone_api_fqdn %>:5000/v3
password = <%= @user_pass %>
project_domain_id = default
project_name = service
region_name = <%= @region %>
user_domain_id = default
username = manila-srv
<%- if @realm == "production" then -%>
memcached_servers = <%= @openstack_controllers.map{|host| "#{host}:11211"}.join(",") %>
<%- else -%>
# not using this on the manila-sharecontroller VM
#memcached_servers = none
<%- end -%>

[neutron]
service_metadata_proxy = true
metadata_proxy_shared_secret = <%= @metadata_proxy_shared_secret %>
auth_url = http://<%= @keystone_api_fqdn %>:5000/v3
auth_type = v3password
password = <%= @user_pass %>
project_domain_name = default
project_name = service
tenant_name = service
user_domain_id = default
user_domain_name = default
username = manila-srv
region_name = <%= @region %>

[nova]
region_name = <%= @region %>
auth_url = http://<%= @keystone_api_fqdn %>:5000/v3
auth_type = v3password
password = <%= @user_pass %>
project_domain_name = default
project_name = service
tenant_name = service
user_domain_id = default
user_domain_name = default
username = manila-srv

[oslo_concurrency]
lock_path = /var/lock/manila

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

[oslo_messaging_rabbit]
rabbit_ha_queues = true

[oslo_middleware]

[oslo_policy]
policy_file = policy.json

[ssl]
