[DEFAULT]
debug = true
osapi_share_base_URL = <%= @keystone_api_fqdn %>
auth_strategy = keystone
state_path = /var/lib/manila
my_ip = <%= @ipaddress %>
osapi_share_listen = <%= @ipaddress %>
osapi_share_listen_port = 8786
osapi_share_workers = 1
osapi_share_use_ssl = false
transport_url = rabbit://<%= @openstack_controllers.map{ |rabbit_host| "#{@rabbit_user}:#{@rabbit_pass}\@#{rabbit_host}:5672" }.join(',') %>


# The full class name of the Networking API class to use. (string
# value)
#network_api_class = manila.network.neutron.neutron_network_plugin.NeutronNetworkPlugin

# Whether to support IPv4 network resource, Default=True. (boolean
# value)
network_plugin_ipv4_enabled = true

# Whether to support IPv6 network resource, Default=False. If this
# option is True, the value of 'network_plugin_ipv4_enabled' will be
# ignored. (boolean value)
network_plugin_ipv6_enabled = false

# The name of the physical network to determine which net segment is
# used. This opt is optional and will only be used for networks
# configured with multiple segments. (string value)
#neutron_physical_net_name = <None>

# Default Neutron network that will be used for share server creation.
# This opt is used only with class 'NeutronSingleNetworkPlugin'.
# (string value)
#neutron_net_id = <None>

# Default Neutron subnet that will be used for share server creation.
# Should be assigned to network defined in opt 'neutron_net_id'. This
# opt is used only with class 'NeutronSingleNetworkPlugin'. (string
# value)
#neutron_subnet_id = <None>


# https://docs.openstack.org/manila/ocata/adminref/network_plugins.html


# Default share type to use. (string value)
#default_share_type = <None>
# Default share group type to use. (string value)
#default_share_group_type = <None>

# A list of share backend names to use. These backend names should be
# backed by a unique [CONFIG] group with its options. (list value)
enabled_share_backends = wmcscinderbackend

[wmcscinderbackend]
share_backend_name = wmcscinderbackend
share_driver = manila.share.drivers.generic.GenericShareDriver
driver_handles_share_servers = True
enabled_share_protocols = NFS
share_name_template = share-%s
share_snapshot_name_template = share-snapshot-%s
# Number of shares allowed per project. (integer value)
quota_shares = 50
# Number of share snapshots allowed per project. (integer value)
quota_snapshots = 50
# Number of share gigabytes allowed per project. (integer value)
quota_gigabytes = 1000
# Number of snapshot gigabytes allowed per project. (integer value)
quota_snapshot_gigabytes = 1000
# Number of share-networks allowed per project. (integer value)
quota_share_networks = 0
# Number of share-replicas allowed per project. (integer value)
quota_share_replicas = 0
# Number of replica gigabytes allowed per project. (integer value)
quota_replica_gigabytes = 0
# Number of share group snapshots allowed. (integer value)
#quota_share_group_snapshots = 50
# Maximum number of volume gigabytes to allow per host. (integer
# value)
max_gigabytes = 10000

# The template for mounting shares for this backend. Must specify the
# executable with all necessary parameters for the protocol supported.
# 'proto' template element may not be required if included in the
# command. 'export' and 'path' template elements are required. It is
# advisable to separate different commands per backend. (string value)
share_mount_template = mount -vt %(proto)s %(options)s %(export)s %(path)s

# The template for unmounting shares for this backend. Must specify
# the executable with all necessary parameters for the protocol
# supported. 'path' template element is required. It is advisable to
# separate different commands per backend. (string value)
share_unmount_template = umount -v %(path)s

# Volume name template. (string value)
volume_name_template = manila-share-%s

# Volume snapshot name template. (string value)
volume_snapshot_name_template = manila-snapshot-%s

# Parent path in service instance where shares will be mounted.
# (string value)
share_mount_path = /shares

# Maximum time to wait for creating cinder volume. (integer value)
#max_time_to_create_volume = 180

# Maximum time to wait for extending cinder volume. (integer value)
#max_time_to_extend_volume = 180

# Maximum time to wait for attaching cinder volume. (integer value)
#max_time_to_attach = 120

# Specify list of share export helpers. (list value)
share_helpers = NFS=manila.share.drivers.helpers.NFSHelper

# Filesystem type of the share volume. (string value)
# Possible values:
# ext4 - <No description provided>
# ext3 - <No description provided>
share_volume_fstype = ext4

volume_api_class = manila.volume.cinder.API
cinder_volume_type = <%= @cinder_volume_type %>

# Base folder where exported shares are located. (string value)
#lvm_share_export_root = $state_path/mnt

# List of IPs to export shares belonging to the LVM storage driver.
# (list value)
#lvm_share_export_ips = <None>

# If set, create LVMs with multiple mirrors. Note that this requires
# lvm_mirrors + 2 PVs with available space. (integer value)
#lvm_share_mirrors = 0

# Name for the VG that will contain exported shares. (string value)
#lvm_share_volume_group = lvm-shares

# Specify list of share export helpers. (list value)
#lvm_share_helpers = CIFS=manila.share.drivers.helpers.CIFSHelperUserAccess,NFS=manila.share.drivers.helpers.NFSHelper

# User in service instance that will be used for authentication.
# (string value)
#service_instance_user = <None>

# Password for service instance user. (string value)
#service_instance_password = <None>

# Path to host's private key. (string value)
#path_to_private_key = <None>

# Maximum time in seconds to wait for creating service instance.
# (integer value)
#max_time_to_build_instance = 300

# Block SSH connection to the service instance from other networks
# than service network. (boolean value)
#limit_ssh_access = false

# Name or ID of service instance in Nova to use for share exports.
# Used only when share servers handling is disabled. (string value)
#service_instance_name_or_id = <None>

# Can be either name of network that is used by service instance
# within Nova to get IP address or IP address itself (either IPv4 or
# IPv6) for managing shares there. Used only when share servers
# handling is disabled. (host address value)
#service_net_name_or_ip = <None>

# Can be either name of network that is used by service instance
# within Nova to get IP address or IP address itself (either IPv4 or
# IPv6) for exporting shares. Used only when share servers handling is
# disabled. (host address value)
#tenant_net_name_or_ip = <None>

# Name of image in Glance, that will be used for service instance
# creation. Only used if driver_handles_share_servers=True. (string
# value)
#service_image_name = manila-service-image

# Name of service instance. Only used if
# driver_handles_share_servers=True. (string value)
#service_instance_name_template = manila_service_instance_%s

# Keypair name that will be created and used for service instances.
# Only used if driver_handles_share_servers=True. (string value)
#manila_service_keypair_name = manila-service

# Path to hosts public key. Only used if
# driver_handles_share_servers=True. (string value)
#path_to_public_key = ~/.ssh/id_rsa.pub

# Security group name, that will be used for service instance
# creation. Only used if driver_handles_share_servers=True. (string
# value)
#service_instance_security_group = manila-service

# ID of flavor, that will be used for service instance creation. Only
# used if driver_handles_share_servers=True. (string value)
service_instance_flavor_id = <%= @nova_flavor_id %>

# Name of manila service network. Used only with Neutron. Only used if
# driver_handles_share_servers=True. (string value)
service_network_name = <%= @manila_neutron_network_name %>

# CIDR of manila service network. Used only with Neutron and if
# driver_handles_share_servers=True. (string value)
#service_network_cidr = 10.254.0.0/16

# This mask is used for dividing service network into subnets, IP
# capacity of subnet with this mask directly defines possible amount
# of created service VMs per tenant's subnet. Used only with Neutron
# and if driver_handles_share_servers=True. (integer value)
#service_network_division_mask = 28

# Attach share server directly to share network. Used only with
# Neutron and if driver_handles_share_servers=True. (boolean value)
#connect_share_server_to_tenant_network = false

# ID of neutron network used to communicate with admin network, to
# create additional admin export locations on. (string value)
#admin_network_id = <None>

# ID of neutron subnet used to communicate with admin network, to
# create additional admin export locations on. Related to
# 'admin_network_id'. (string value)
#admin_subnet_id = <None>

# Whether share servers will be deleted on deletion of the last share.
# (boolean value)
#delete_share_server_with_last_share = false

# If set to True, then manila will deny access and remove all access
# rules on share unmanage.If set to False - nothing will be changed.
# (boolean value)
#unmanage_remove_access_rules = false

# If set to True, then Manila will delete all share servers which were
# unused more than specified time .If set to False - automatic
# deletion of share servers will be disabled. (boolean value)
automatic_share_server_cleanup = false

[cinder]
region_name = <%= @region %>
auth_url = http://<%= @keystone_api_fqdn %>:8776/v3/
auth_type = v3password
password = <%= @ldap_user_pass %>
project_domain_name = default
project_name = admin
auth_type = v3password
default_domain_name = admin
domain_name = default
password = <%= @ldap_user_pass %>
project_domain_name = default
project_name = admin
user_domain_id = default
user_domain_name = default
username = novaadmin

[database]
connection = mysql+pymysql://<%= @db_user %>:<%= @db_pass %>@<%= @db_host %>/<%= @db_name %>

[glance]
api_microversion = 2
region_name = <%= @region %>
auth_url = http://<%= @keystone_api_fqdn %>:9292
auth_type = v3password
default_domain_name = admin
domain_name = default
password = <%= @ldap_user_pass %>
project_domain_name = default
project_name = admin
user_domain_id = default
user_domain_name = default
username = novaadmin

[keystone_authtoken]
auth_host = <%= @keystone_api_fqdn %>
auth_protocol = http
admin_user = novaadmin
admin_tenant_name = admin
www_authenticate_uri = http://<%= @keystone_api_fqdn %>:5000
auth_url = http://<%= @keystone_api_fqdn %>:35357
auth_type = password
project_domain_name = default
user_domain_name = default
project_name = admin
username = novaadmin
password = <%= @ldap_user_pass %>
memcached_servers = <%= @openstack_controllers.map{|host| "#{host}:11211"}.join(",") %>
region_name = <%= @region %>
# We want this but need to figure out about service roles first
#service_token_roles_required = True

[neutron]
service_metadata_proxy = true
metadata_proxy_shared_secret = <%= @metadata_proxy_shared_secret %>
auth_url = http://<%= @keystone_api_fqdn %>:5000/v3
auth_type = v3password
password = <%= @ldap_user_pass %>
project_domain_name = default
project_name = admin
tenant_name = admin
user_domain_id = default
user_domain_name = default
username = novaadmin
region_name = <%= @region %>

[nova]
region_name = <%= @region %>
auth_url = http://<%= @keystone_api_fqdn %>:8774/v2.1
auth_type = v3password
password = <%= @ldap_user_pass %>
project_domain_name = default
project_name = admin
tenant_name = admin
user_domain_id = default
user_domain_name = default
username = novaadmin

[oslo_concurrency]
lock_path = /var/lock/manila

[oslo_messaging_amqp]

[oslo_messaging_kafka]

[oslo_messaging_notifications]

[oslo_messaging_rabbit]
rabbit_ha_queues = true

[oslo_middleware]

[oslo_policy]
policy_file = policy.json

[ssl]
